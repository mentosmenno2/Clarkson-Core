<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>WP Hookdoc: Source: lib/clarkson-core-gutenberg-block-type.php</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lib/clarkson-core-gutenberg-block-type.php</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>&lt;?php
/**
 * Allows for extension of Gutenberg blocks and overwriting rendering functions.
 *
 * @package CLARKSON\Lib
 * @since 0.4.0
 */

/**
 * This custom block overwrites the render callback to use twig files.
 * It is automatically injected into all registered blocks at render time.
 */
class Clarkson_Core_Gutenberg_Block_Type extends \WP_Block_Type {
	/**
	 * Replaces the original block render function, and saves the original render
	 * function in case we can't find a fitting twig file.
	 *
	 * @param string       $block_type Block type name including namespace.
	 * @param array|string $args       Optional. Array or string of arguments for registering a block type.
	 */
	public function __construct( $block_type, $args = array() ) {
		parent::__construct( $block_type, $args );
		$this->original_render_callback = $this->render_callback;
		$this->render_callback          = array( $this, 'clarkson_render_callback' );
	}

	/**
	 * Allows filtering of the path where this blocks twig file is found.
	 *
	 * @return string
	 */
	public function get_twig_template_path() {
		/**
		 * Allows theme to overwrite the directory in which Clarkson Core automatically loads twig templates for blocks.
		 *
		 * @hook clarkson_core_gutenberg_block_template_directory
		 * @since 0.4.0
		 * @param {string} '/templates/partials/blocks/gb/' Directory that will be used to automatically load gutenberg block templates.
		 * @return {string} Directory to use for autoloading twig templates.
		 *
		 * @example
		 * // Overwrite the Gutenberg block template directory.
		 * add_filter(
		 *  'clarkson_core_gutenberg_block_template_directory',
		 *  function() {
		 *      return '/templates/gutenberg/blocks/';
		 *  }
		 * );
		 */
		$block_directory = apply_filters( 'clarkson_core_gutenberg_block_template_directory', '/templates/partials/blocks/gb/' );

		/**
		 * Allows theme to overwrite the twig templates used for a specific block.
		 *
		 * @hook clarkson_core_gutenberg_block_template_{$name}
		 * @since 0.4.0
		 * @param {string} $template Original twig template that Clarkson Core is going to load for the block.
		 * @return {string} Path to twig template used to render a block.
		 *
		 * @example
		 * // Overwrite a specific block template.
		 * add_filter(
		 *  'clarkson_core_gutenberg_block_template_org/events',
		 *  function() {
		 *      return get_stylesheet_directory() . '/templates/gutenberg/alternative-event-template.twig';
		 *  }
		 * );
		 */
		return apply_filters( 'clarkson_core_gutenberg_block_template_' . $this->name, get_stylesheet_directory() . $block_directory . $this->name . '.twig', $this );
	}

	/**
	 * Tries to find a twig file to use for rendering. If the twig file doesn't
	 * exists it falls back to the original render callback.
	 * @param array  $attributes Block attributes.
	 * @param string $content    Block content.
	 * @return string Rendered block type output.
	 */
	public function clarkson_render_callback( $attributes, $content ) {
		if ( file_exists( $this->get_twig_template_path() ) ) {
			$cc_template              = Clarkson_Core_Templates::get_instance();
			$this->content_attributes = $attributes;
			return (string) $cc_template->render_twig(
				$this->get_twig_template_path(),
				array(
					'data'    => $attributes,
					'content' => $content,
					'block'   => $this,
				),
				true
			);
		}
		if ( is_callable( $this->original_render_callback ) ) {
			return (string) call_user_func( $this->original_render_callback, $attributes, $content );
		}
		return $content;
	}
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Filters</h3><ul><li><a href="clarkson_available_objects.html">clarkson_available_objects</a></li><li><a href="clarkson_available_objects_paths.html">clarkson_available_objects_paths</a></li><li><a href="clarkson_context_args.html">clarkson_context_args</a></li><li><a href="clarkson_core_autoload_dirs.html">clarkson_core_autoload_dirs</a></li><li><a href="clarkson_core_autoload_theme_pre_020.html">clarkson_core_autoload_theme_pre_020</a></li><li><a href="clarkson_core_available_templates.html">clarkson_core_available_templates</a></li><li><a href="clarkson_core_create_object_callback.html">clarkson_core_create_object_callback</a></li><li><a href="clarkson_core_deprecated_warning_page_template.html">clarkson_core_deprecated_warning_page_template</a></li><li><a href="clarkson_core_gutenberg_block_class.html">clarkson_core_gutenberg_block_class</a></li><li><a href="clarkson_core_gutenberg_block_class_%257B$name%257D.html">clarkson_core_gutenberg_block_class_{$name}</a></li><li><a href="clarkson_core_gutenberg_block_template_directory.html">clarkson_core_gutenberg_block_template_directory</a></li><li><a href="clarkson_core_gutenberg_block_template_%257B$name%257D.html">clarkson_core_gutenberg_block_template_{$name}</a></li><li><a href="clarkson_core_template_paths.html">clarkson_core_template_paths</a></li><li><a href="clarkson_core_templates_types_for_%257B$name%257D.html">clarkson_core_templates_types_for_{$name}</a></li><li><a href="clarkson_object_type.html">clarkson_object_type</a></li><li><a href="clarkson_twig_args.html">clarkson_twig_args</a></li><li><a href="clarkson_twig_functions.html">clarkson_twig_functions</a></li><li><a href="clarkson_twig_stylesheet_dir.html">clarkson_twig_stylesheet_dir</a></li><li><a href="clarkson_twig_template_dir.html">clarkson_twig_template_dir</a></li><li><a href="clarkson_twig_template_dirs.html">clarkson_twig_template_dirs</a></li></ul>
</nav>

<br class="clear">

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
